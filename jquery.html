<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE HTML> 
<html xmlns="http://www.w3.org/1999/xhtml"> 
	<head> 
		<title>Control</title>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script>
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.min.js"></script>
		<link rel="stylesheet" href="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.9/themes/dot-luv/jquery-ui.css" type="text/css" />
		<script type="text/javascript">
			var manager = "http://ceol.l42.eu/";
			var statshashcode = null;
			var playlisthashcode = null;
			function poll(data) {
				if (data.hashcode != null) {
					statshashcode = data.hashcode;
					setNow(data.now.metadata);
					if (data.isPlaying) $("#playpause").val("▮▮");
					else $("#playpause").val("►");
					$("#volume").slider("value", data.volume);
				}
				$.get(manager+"poll", { hashcode: statshashcode }, poll).error(function () {
					
					// If there's a problem with the server, wait 5 seconds and try again.
					newpoll(poll, 5000);
				});
			}
			function playlistpoll(data) {
				if (data.hashcode != null) {
					playlisthashcode = data.hashcode;
					$("#playlist ol").empty();
					for (ii in data.playlist) {
						var track = $("<li class='track' />").appendTo($('#playlist ol'));
						$("<h3 />").text(data.playlist[ii].metadata.title).appendTo(track);
						$("<a>⤠</a>").attr('href', data.playlist[ii].url).attr('target', '_blank').appendTo(track);
					}
					playlistHeight();
				}
				$.get(manager+"poll/playlist", { hashcode: playlisthashcode }, playlistpoll).error(function () {
					
					// If there's a problem with the server, wait 5 seconds and try again.
					newpoll(playlistpoll, 5000);
				});
			}
			function setNow(metadata) {
				var now = $("#now span");
				now.empty();
				if (metadata.exturl) $("<span class='link'/>").text('exturl ⤤').appendTo(now).click(function() {$.get(manager+"openexturl");});
				if (metadata.editurl) $("<span class='link'/>").text('edit ⤤').appendTo(now).click(function() {$.get(manager+"openediturl");});
				$("<span />").text(metadata.title).appendTo(now);
				if (metadata.artist) $("<span />").text(metadata.artist).appendTo(now);
				$("#now img").attr('src', metadata.thumb);
			}
			function newpoll(pollfunc, wait) {
				if (wait == null) wait = 0;
				setTimeout(function () {pollfunc(new Object());}, wait);
			}
			function newButton( id, text, action) {
				if (action == null) action = id;
				$("<input type='button' class='button' value='button'/>").click(function() { $.get(manager+action); }).appendTo("#controls").attr('id', id).button().attr('value', text);
			}
			function playlistHeight() {
				$('#playlist').css('height', 0);
				if ($('#playlist').height()) return;
				$('#playlist').css('height', $(window).height() - $('body').height());
			}
		  $(document).ready(function (){
			newButton('playpause');
			newButton('next', 'Next');
			$(window).resize(playlistHeight);
			$("<div id='volume'/>").appendTo("#controls").slider({
				orientation: "vertical",
				range: "min",
				min: 0,
				max: 1,
				value: 1,
				step: 0.1,
				animate: true,
				slide: function( event, ui ) {
					$.get(manager+"volume", { volume: ui.value });
				},
			});
			$(window).load(function (){
				newpoll(poll);
				newpoll(playlistpoll);
			});
		  });
		</script>
		<style type="text/css">
			html {
				width: 100%;
			}
			body {
				background: #004;
				color: #ff0;
				margin: 0;
				width: 100%;
			}
			#now {
				border: ridge;
				padding: 1em;
				text-align: center;
			}
			#now span{
				display:block;
			}
			#now img {
				display: block;
				height: 100px;
				margin: 1em auto;
				-webkit-box-reflect: below 0 -webkit-gradient(linear, left top, left bottom, from(rgba(255, 255, 255, 0)), to(rgba(255, 255, 255, 0.5)), color-stop(0.7, transparent)); 
			}
			#now a {
				float:right;
				color: #ccf;
				text-decoration:none;
			}
			#controls {
				background: #404;
				float: left;
				width: 100%;
			}
			#controls > * {
				float: left;
			}
			.button {
				padding:1em;
				margin: 1em;
				font-weight: bold;
				width: 5em;
			}
			#playlist {
				color: #c0c;
				overflow: auto;
				margin: 0;
				padding: 1em;
				border: inset;
				clear:both;
			}
			#playlist h3 {
				color: #909;
				margin: 0;
				display: inline;
			}
			#playlist a{
				margin: 0 1em;
				text-decoration:none;
				vertical-align:super;
			}
			#playlist ol{
				list-style-type: none;
			}
			.link{
				cursor: pointer;
				float: right;
				clear: right;
			}
			.link:hover{
				text-decoration: underline;
			}
		</style>
	</head>
	<body>
	
		<div id='now'><h2>Now Playing</h2><span></span><img alt='' src='/thumb.png' /></div>
		<form id='controls'></form>
		<div id='playlist'><h2>Playlist</h2><ol></ol></div>
	</body>
</html>
 
